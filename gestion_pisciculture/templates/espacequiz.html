<!DOCTYPE html>
<html>
   <head>
      <!-- Basic -->
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <!-- Mobile Metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
      <!-- Site Metas -->
      <meta name="keywords" content="" />
      <meta name="description" content="" />
      <meta name="author" content="" />
      <link rel="shortcut icon" href="static/images/logofada.png" type="">
      <title>Bible Quiz Fada</title>
      <!-- bootstrap core css -->
      <link rel="stylesheet" type="text/css" href="static/css/bootstrap.css" />
      <!-- font awesome style -->
      <link href="static/css/font-awesome.min.css" rel="stylesheet" />
      <!-- Custom styles for this template -->
      <link href="static/css/style.css" rel="stylesheet" />
      <!-- responsive style -->
      <link href="static/css/responsive.css" rel="stylesheet" />
      <style>
         .radio-large {
             transform: scale(2.5);
             margin-right: 20px;
         }
     </style>
   </head>
   <body class="sub_page">
      <div class="hero_area">
         <!-- header section strats -->
         <header class="header_section">
            <div class="container">
               <nav class="navbar navbar-expand-lg custom_nav-container ">
                  <a class="navbar-brand" href="{% url 'accueil' %}"><img width="100" src="static/images/logofada.png" alt="#" /></a>
                  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class=""> </span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                     <ul class="navbar-nav">
                        <li class="nav-item active">
                           <a class="nav-link" href="{% url 'accueil' %}">Accueil <span class="sr-only">(current)</span></a>
                        </li>
                       <li class="nav-item dropdown">
                           <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true"> <span class="nav-label">Pages <span class="caret"></span></a>
                           <ul class="dropdown-menu">
                              <li><a href="{% url 'apropos' %}">A propos</a></li>
                              <li><a href="{% url 'temoignages' %}">Temoignages</a></li>
                           </ul>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="{% url 'predications' %}">Prédiations</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="{% url 'show_questions' %}">Espace Quiz</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="{% url 'maperformance' %}">Mes statistiques</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="{% url 'contacts' %}">Contact</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="#">
                              <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 456.029 456.029" style="enable-background:new 0 0 456.029 456.029;" xml:space="preserve">
                                 <g>
                                    <g>
                                       <path d="M345.6,338.862c-29.184,0-53.248,23.552-53.248,53.248c0,29.184,23.552,53.248,53.248,53.248
                                          c29.184,0,53.248-23.552,53.248-53.248C398.336,362.926,374.784,338.862,345.6,338.862z" />
                                    </g>
                                 </g>
                                 <g>
                                    <g>
                                       <path d="M439.296,84.91c-1.024,0-2.56-0.512-4.096-0.512H112.64l-5.12-34.304C104.448,27.566,84.992,10.67,61.952,10.67H20.48
                                          C9.216,10.67,0,19.886,0,31.15c0,11.264,9.216,20.48,20.48,20.48h41.472c2.56,0,4.608,2.048,5.12,4.608l31.744,216.064
                                          c4.096,27.136,27.648,47.616,55.296,47.616h212.992c26.624,0,49.664-18.944,55.296-45.056l33.28-166.4
                                          C457.728,97.71,450.56,86.958,439.296,84.91z" />
                                    </g>
                                 </g>
                                 <g>
                                    <g>
                                       <path d="M215.04,389.55c-1.024-28.16-24.576-50.688-52.736-50.688c-29.696,1.536-52.224,26.112-51.2,55.296
                                          c1.024,28.16,24.064,50.688,52.224,50.688h1.024C193.536,443.31,216.576,418.734,215.04,389.55z" />
                                    </g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                                 <g>
                                 </g>
                              </svg>
                           </a>
                        </li>
                        <form class="form-inline" action="{% url 'logout' %}">
                           <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit">
                              
                           <i class="fa fa-power-off" aria-hidden="true"></i>
                           </button>
                        </form>
                     </ul>
                  </div>
               </nav>
            </div>
         </header>
         <!-- end header section -->
      </div>
      <!-- inner page section -->
      
      <section class="inner_page_head">
         <div class="container_fuild">
            <div class="row">
               <div class="col-md-12">
                  <div class="full">
                     <h3>Espace Quiz</h3>
                  </div>
                  <div class="box">
                     <div class="detail-box">
                        <h5>Mon solde : {{ solde_question }} question(s)</h5>
                        <h5>Mes points : {{ nb_point }} réponse(s)</h5>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </section>


      <!-- end inner page section -->
      <!-- why section -->
      <section class="why_section layout_padding">
         <div class="container">
            <form id="answer-form" method="post" action="{% url 'save_answers_derniere' %}">
               {% csrf_token %}
               {% for question in questions %}
               <div class="heading_container heading_center question" id="question{{ forloop.counter }}" data-question-id="{{ question.id }}">
                   <h2>Question</h2>
                   
                           <h4>
                              {{ question.question_text }}
                           </h4>
                     
                   <div class="row">
                     
                       
                        {% for answer in question.answer_set.all %} 
                     
                      
                       <div class="col-md-4">
                           <div class="box">
                               <div class="img-box">
                                   <!-- SVG content here -->
                               </div>
                               <div class="detail-box">
                                   
                                   <div class="responses-affiche">
                                       <input type="hidden" name="question_idd" value="{{ question.id }}">
                                       <input type="radio" id="answer{{ answer.id }}" name="question{{ question.id }}" value="{{ answer.id }}" class="radio-large">
                                       <label for="answer{{ answer.id }}">{{ answer.answer_text }}</label><br>
                                   </div>
                               </div>
                           </div>
                       </div>
                       {% endfor %}
                   </div>
               </div>
               {% endfor %}
               <p></p>
               
               <button class="btn btn-success" type="button" id="next-question-btn">Question suivante</button>
               <button class="btn btn-success" type="submit" id="submit-btn" style="display: none;">Dernière question</button>
           </form>
           
         </div>
      </section>

      <section class="product_section layout_padding">
         <div class="container">
            <div class="heading_container heading_center">
               <h2>
                  Mes <span>Statistiques</span>
               </h2>
            </div>
            <div class="row">
               <div class="col-sm-6 col-md-4 col-lg-3">
                  <div class="box">
                     <!-- <div class="option_container"> -->
                        <div class="detail-box">
                           <h5>
                             les Questions autorisées/jour :
                           </h5>
                           
                        </div>
                        <div class="">
                        <div class="options">
                           <a href="" class="option1">
                              <h3 class="fs-4 flex-grow-1 mb-3" >5</h3>
                              
                           </a>
                           <!-- <a href="" class="option2">
                           Buy Now
                           </a> -->
                        </div>
                     </div>
                    

                  </div>
               </div>
               <div class="col-sm-6 col-md-4 col-lg-3">
                  <div class="box">
                     <div class="detail-box">
                        <h5>
                          Les Questions répondues :   
                        </h5>
                        
                     </div>
                     <div class="">
                        <div class="options">
                           <a href="" class="option1">
                           <h3 class="fs-4 flex-grow-1 mb-3" id="userResponseCount">{{ userResponse_today_count }}</h3>
                           </a>
                        
                        </div>
                     </div>
                     
                     
                  </div>
               </div>
               <div class="col-sm-6 col-md-4 col-lg-3">
                  <div class="box">
                                        
                     <div class="detail-box">
                        <h5>
                           Les Réponses Justes :
                        </h5>

                     </div>
                     <div class="">
                        <div class="options">
                           <a href="" class="option1">
                           <h3 class="fs-4 flex-grow-1 mb-3" id="userResponseCountJust"> {{ userResponse_today_count_just }}</h3>
                           </a>

                        </div>
                     </div>

                  </div>
               </div>
               <div class="col-sm-6 col-md-4 col-lg-3">
                  <div class="box">
                     <div class="detail-box">
                        <h5>
                           Les Réponses Fausses :
                        </h5>
                     </div>
                     <div class="">
                        <div class="options">
                           <a href="" class="option1">
                            <h3 class="fs-4 flex-grow-1 mb-3" id="userResponseCountFaux">{{ userResponse_today_count_faux }}</h3>
                           </a>
                        </div>
                     </div>
                    

                  </div>
               </div>
 
            </div>

         </div>
      </section>
      <!-- end why section -->
      <!-- footer section -->
      <footer class="footer_section">
         <div class="container">
            <div class="row">
               <div class="col-md-4 footer-col">
                  <div class="footer_contact">
                     <h4>
                        Reach at..
                     </h4>
                     <div class="contact_link_box">
                        <a href="">
                        <i class="fa fa-map-marker" aria-hidden="true"></i>
                        <span>
                        Location
                        </span>
                        </a>
                        <a href="">
                        <i class="fa fa-phone" aria-hidden="true"></i>
                        <span>
                        Call +225 0544169597
                        </span>
                        </a>
                        <a href="">
                        <i class="fa fa-envelope" aria-hidden="true"></i>
                        <span>
                        ogaarmand5@gmail.com
                        </span>
                        </a>
                     </div>
                  </div>
               </div>
               <div class="col-md-4 footer-col">
                  <div class="footer_detail">
                     <a href="index.html" class="footer-logo">
                     Bible Quiz Fada
                     </a>
                     <p>
                        Necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with
                     </p>
                     <div class="footer_social">
                        <a href="">
                        <i class="fa fa-facebook" aria-hidden="true"></i>
                        </a>
                        <a href="">
                        <i class="fa fa-twitter" aria-hidden="true"></i>
                        </a>
                        <a href="">
                        <i class="fa fa-linkedin" aria-hidden="true"></i>
                        </a>
                        <a href="">
                        <i class="fa fa-instagram" aria-hidden="true"></i>
                        </a>
                        <a href="">
                        <i class="fa fa-pinterest" aria-hidden="true"></i>
                        </a>
                     </div>
                  </div>
               </div>
               <div class="col-md-4 footer-col">
                  <div class="map_container">
                     <div class="map">
                        <div id="googleMap"></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="footer-info">
               <div class="col-lg-7 mx-auto px-0">
                  <p>
                     &copy; <span id="displayYear"></span> All Rights Reserved By
                     <a href="https://html.design/">Free Html Templates</a>
                  </p>
               </div>
            </div>
         </div>
      </footer>
      <!-- footer section -->
      <!-- jQery -->
      <script src="static/js/jquery-3.4.1.min.js"></script>
      <!-- popper js -->
      <script src="static/js/popper.min.js"></script>
      <!-- bootstrap js -->
      <script src="static/js/bootstrap.js"></script>
      <!-- custom js -->
      <script src="static/js/custom.js"></script>
      <script>
 document.addEventListener("DOMContentLoaded", function () {
    var currentQuestionIndex = 0;
    var questions = document.querySelectorAll(".question");
    var nextButton = document.getElementById("next-question-btn");
    var submitButton = document.getElementById("submit-btn");

    // Masquer toutes les questions sauf la première
    for (var i = 1; i < questions.length; i++) {
        questions[i].style.display = "none";
    }

    if (questions.length === 1) {
        submitButton.style.display = "block";
        nextButton.style.display = "none";
    }

    // Gérer le clic sur le bouton "Question suivante"
    nextButton.addEventListener("click", function () {
        var selectedAnswerId = getSelectedAnswerId();
        if (selectedAnswerId !== null) {
            saveAnswer(selectedAnswerId);

            questions[currentQuestionIndex].style.display = "none";
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                questions[currentQuestionIndex].style.display = "block";

                if (currentQuestionIndex === questions.length - 1) {
                    // Si c'est la dernière question, afficher le bouton de soumission
                    submitButton.style.display = "block";
                    nextButton.style.display = "none";
                }
            }
        } else {
            alert("Veuillez sélectionner une réponse avant de passer à la question suivante.");
        }
    });

    // Fonction pour obtenir l'ID de la réponse sélectionnée
    function getSelectedAnswerId() {
        var radioButtons = questions[currentQuestionIndex].querySelectorAll("input[type='radio']");
        for (var i = 0; i < radioButtons.length; i++) {
            if (radioButtons[i].checked) {
                return radioButtons[i].value;
            }
        }
        return null;
    }

    // Fonction pour enregistrer la réponse avec AJAX
    function saveAnswer(answerId) {
        var questionId = getCurrentQuestionId();
        var Idquestion_aff = getCurrentQuestionIdaff();
        var data = {
            'question_id': questionId,
            'answer_id': answerId,
            'Idquestion_aff':Idquestion_aff,
        };

        fetch('save_answers', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.ok) {
                console.log('Réponse enregistrée avec succès.');
                fetchAndUpdateResponseCounts();
            } else {
                console.error('Erreur lors de l\'enregistrement de la réponse.');
                alert('Erreur lors de l\'enregistrement de la réponse.')
            }
        })
        .catch(error => {
            console.error('Erreur lors de l\'enregistrement de la réponse :', error);
        });
        function getCurrentQuestionIdaff() {
                idquestion_aff = currentQuestionIndex
                idquestion_aff++
            
        return questions[idquestion_aff].dataset.questionId;
        }
    }

    function getCurrentQuestionId() {
        return questions[currentQuestionIndex].dataset.questionId;
    }

    // Fonction pour obtenir la valeur du jeton CSRF
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Code JavaScript pour effectuer une requête AJAX pour récupérer les nouvelles valeurs des réponses
    function fetchAndUpdateResponseCounts() {
        fetch('actualise_user_response')
            .then(response => response.json())
            .then(data => updateResponseCounts(data))
            .catch(error => console.error('Error fetching response counts:', error));
    }

    // Code JavaScript pour mettre à jour les valeurs sur la page
    function updateResponseCounts(responseData) {
        document.getElementById('userResponseCount').innerText = responseData.userResponse_today_count;
        document.getElementById('userResponseCountJust').innerText = responseData.userResponse_today_count_just;
        document.getElementById('userResponseCountFaux').innerText = responseData.userResponse_today_count_faux;
        document.getElementById('status_reponse').innerText = responseData.succes;
    }
});

      </script>
   </body>
</html>